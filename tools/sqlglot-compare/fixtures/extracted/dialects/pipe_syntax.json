{
  "dialect": "pipe_syntax",
  "identity": [
    {
      "sql": "FROM x",
      "expected": "SELECT * FROM x"
    },
    {
      "sql": "FROM x |> SELECT x1, x2",
      "expected": "WITH __tmp1 AS (SELECT x1, x2 FROM x) SELECT * FROM __tmp1"
    },
    {
      "sql": "FROM x |> SELECT x.x1, x.x2",
      "expected": "WITH __tmp1 AS (SELECT x.x1, x.x2 FROM x) SELECT * FROM __tmp1"
    },
    {
      "sql": "FROM x |> SELECT x1 as c1, x2 as c2",
      "expected": "WITH __tmp1 AS (SELECT x1 AS c1, x2 AS c2 FROM x) SELECT * FROM __tmp1"
    },
    {
      "sql": "FROM x |> SELECT x1 + 1 as x1_a, x2 - 1 as x2_a |> WHERE x1_a > 1",
      "expected": "WITH __tmp1 AS (SELECT x1 + 1 AS x1_a, x2 - 1 AS x2_a FROM x) SELECT * FROM __tmp1 WHERE x1_a > 1"
    },
    {
      "sql": "FROM x |> SELECT x1 + 1 as x1_a, x2 - 1 as x2_a |> WHERE x1_a > 1 |> SELECT x2_a",
      "expected": "WITH __tmp1 AS (SELECT x1 + 1 AS x1_a, x2 - 1 AS x2_a FROM x), __tmp2 AS (SELECT x2_a FROM __tmp1 WHERE x1_a > 1) SELECT * FROM __tmp2"
    },
    {
      "sql": "FROM x |> WHERE x1 > 0 OR x2 > 0 |> WHERE x3 > 1 AND x4 > 1 |> SELECT x1, x4",
      "expected": "WITH __tmp1 AS (SELECT x1, x4 FROM x WHERE (x1 > 0 OR x2 > 0) AND (x3 > 1 AND x4 > 1)) SELECT * FROM __tmp1"
    },
    {
      "sql": "FROM x |> WHERE x1 > 1 |> WHERE x2 > 2 |> SELECT x1 as gt1, x2 as gt2",
      "expected": "WITH __tmp1 AS (SELECT x1 AS gt1, x2 AS gt2 FROM x WHERE x1 > 1 AND x2 > 2) SELECT * FROM __tmp1"
    },
    {
      "sql": "FROM x |> WHERE x1 > 1 AND x2 > 2 |> SELECT x1 as gt1, x2 as gt2 |> SELECT gt1 * 2 + gt2 * 2 AS gt2_2",
      "expected": "WITH __tmp1 AS (SELECT x1 AS gt1, x2 AS gt2 FROM x WHERE x1 > 1 AND x2 > 2), __tmp2 AS (SELECT gt1 * 2 + gt2 * 2 AS gt2_2 FROM __tmp1) SELECT * FROM __tmp2"
    },
    {
      "sql": "SELECT 1 AS y, 2 AS x |> SELECT x, y",
      "expected": "WITH __tmp1 AS (SELECT x, y FROM (SELECT 1 AS y, 2 AS x)) SELECT * FROM __tmp1"
    },
    {
      "sql": "SELECT x1, x2, x3 FROM x |> AS a_x |> WHERE a_x.x1 > 0",
      "expected": "WITH a_x AS (SELECT x1, x2, x3 FROM x) SELECT * FROM a_x WHERE a_x.x1 > 0"
    },
    {
      "sql": "SELECT x,y FROM (SELECT 1 as x, 2 as y) |> SELECT x, y",
      "expected": "WITH __tmp1 AS (SELECT x, y FROM (SELECT 1 AS x, 2 AS y)) SELECT * FROM __tmp1"
    },
    {
      "sql": "SELECT 'foo1' AS item1, 2 AS item2 UNION ALL SELECT 'foo2' AS item1, 5 AS item2 |> EXTEND SUM(item2) OVER() AS item2_sum",
      "expected": "WITH __tmp1 AS (SELECT *, SUM(item2) OVER () AS item2_sum FROM (SELECT 'foo1' AS item1, 2 AS item2 UNION ALL SELECT 'foo2' AS item1, 5 AS item2)) SELECT * FROM __tmp1"
    },
    {
      "sql": "SELECT x, x1 FROM (FROM (SELECT 1 as x, 2 as x1) |> AGGREGATE SUM(x1) as xx GROUP BY x,x1) |> SELECT x",
      "expected": "WITH __tmp2 AS (SELECT x FROM (SELECT * FROM (WITH __tmp1 AS (SELECT SUM(x1) AS xx, x, x1 FROM (SELECT 1 AS x, 2 AS x1) GROUP BY x, x1) SELECT * FROM __tmp1))) SELECT * FROM __tmp2"
    },
    {
      "sql": "FROM (SELECT 1 as x1) AS x |> SELECT x.x1 |> UNION ALL (FROM (SELECT 1 AS c) |> SELECT c) |> SELECT x1",
      "expected": "SELECT * FROM (WITH __tmp1 AS (SELECT x.x1 FROM (SELECT 1 AS x1) AS x), __tmp3 AS (SELECT * FROM __tmp1), __tmp4 AS (SELECT * FROM __tmp3 UNION ALL SELECT * FROM (WITH __tmp2 AS (SELECT c FROM (SELECT 1 AS c)) SELECT * FROM __tmp2)), __tmp5 AS (SELECT x1 FROM __tmp4) SELECT * FROM __tmp5)"
    },
    {
      "sql": "FROM (SELECT x1 FROM (SELECT 1 as x1) |> SELECT x1) |> SELECT x1",
      "expected": "SELECT * FROM (WITH __tmp2 AS (SELECT x1 FROM ((WITH __tmp1 AS (SELECT x1 FROM (SELECT 1 AS x1)) SELECT * FROM __tmp1))) SELECT * FROM __tmp2)"
    },
    {
      "sql": "SELECT * FROM (FROM t2 |> SELECT id)",
      "expected": "SELECT * FROM (WITH __tmp1 AS (SELECT id FROM t2) SELECT * FROM __tmp1)"
    },
    {
      "sql": "SELECT * FROM t1 LEFT JOIN (FROM t2 |> SELECT id) ON TRUE",
      "expected": "SELECT * FROM t1 LEFT JOIN (WITH __tmp1 AS (SELECT id FROM t2) SELECT * FROM __tmp1) ON TRUE"
    },
    {
      "sql": "FROM x |> ORDER BY x1",
      "expected": "SELECT * FROM x ORDER BY x1"
    },
    {
      "sql": "FROM x |> ORDER BY x1 |> ORDER BY x2",
      "expected": "SELECT * FROM x ORDER BY x2"
    },
    {
      "sql": "FROM x |> ORDER BY x1 |> WHERE x1 > 0 OR x1 != 1 |> ORDER BY x2 |> WHERE x2 > 0 AND x2 != 1 |> SELECT x1, x2",
      "expected": "WITH __tmp1 AS (SELECT x1, x2 FROM x WHERE (x1 > 0 OR x1 <> 1) AND (x2 > 0 AND x2 <> 1) ORDER BY x2) SELECT * FROM __tmp1"
    },
    {
      "sql": "FROM x |> ORDER BY x1 |> WHERE x1 > 0 |> SELECT x1",
      "expected": "WITH __tmp1 AS (SELECT x1 FROM x WHERE x1 > 0 ORDER BY x1) SELECT * FROM __tmp1"
    },
    {
      "sql": "FROM x |> WHERE x1 > 0 |> SELECT x1 |> ORDER BY x1",
      "expected": "WITH __tmp1 AS (SELECT x1 FROM x WHERE x1 > 0) SELECT * FROM __tmp1 ORDER BY x1"
    },
    {
      "sql": "FROM x |> SELECT x1, x2, x3 |> ORDER BY x1 DESC NULLS FIRST, x2 ASC NULLS LAST, x3",
      "expected": "WITH __tmp1 AS (SELECT x1, x2, x3 FROM x) SELECT * FROM __tmp1 ORDER BY x1 DESC NULLS FIRST, x2 ASC NULLS LAST, x3"
    },
    {
      "sql": "FROM x |> SELECT x1, x2 |> LIMIT 2 |> LIMIT 4",
      "expected": "WITH __tmp1 AS (SELECT x1, x2 FROM x) SELECT * FROM __tmp1 LIMIT 2"
    },
    {
      "sql": "FROM x |> SELECT x1, x2 |> LIMIT 2 OFFSET 2 |> LIMIT 4 OFFSET 2",
      "expected": "WITH __tmp1 AS (SELECT x1, x2 FROM x) SELECT * FROM __tmp1 LIMIT 2 OFFSET 4"
    },
    {
      "sql": "FROM x |> AGGREGATE SUM(x1), MAX(x2), MIN(x3)",
      "expected": "WITH __tmp1 AS (SELECT SUM(x1), MAX(x2), MIN(x3) FROM x) SELECT * FROM __tmp1"
    },
    {
      "sql": "FROM x |> AGGREGATE SUM(x1) AS s_x1 |> SELECT s_x1",
      "expected": "WITH __tmp1 AS (SELECT SUM(x1) AS s_x1 FROM x), __tmp2 AS (SELECT s_x1 FROM __tmp1) SELECT * FROM __tmp2"
    },
    {
      "sql": "FROM x |> AGGREGATE SUM(x1), MAX(x2), MIN(x3) GROUP BY x4, x5",
      "expected": "WITH __tmp1 AS (SELECT SUM(x1), MAX(x2), MIN(x3), x4, x5 FROM x GROUP BY x4, x5) SELECT * FROM __tmp1"
    },
    {
      "sql": "FROM x |> AGGREGATE SUM(x1), MAX(x2), MIN(x3) GROUP BY x4 AS a_x4, x5 AS a_x5",
      "expected": "WITH __tmp1 AS (SELECT SUM(x1), MAX(x2), MIN(x3), x4 AS a_x4, x5 AS a_x5 FROM x GROUP BY a_x4, a_x5) SELECT * FROM __tmp1"
    },
    {
      "sql": "FROM x |> AGGREGATE SUM(x1) as s_x1 GROUP BY x1 |> SELECT s_x1, x1 as ss_x1",
      "expected": "WITH __tmp1 AS (SELECT SUM(x1) AS s_x1, x1 FROM x GROUP BY x1), __tmp2 AS (SELECT s_x1, x1 AS ss_x1 FROM __tmp1) SELECT * FROM __tmp2"
    },
    {
      "sql": "FROM x |> AGGREGATE SUM(x1) GROUP",
      "expected": "WITH __tmp1 AS (SELECT SUM(x1) AS GROUP FROM x) SELECT * FROM __tmp1"
    },
    {
      "sql": "FROM x |> AGGREGATE SUM(x1) as s_x1 GROUP BY x2 as g_x2 |> WHERE s_x1 > 0",
      "expected": "WITH __tmp1 AS (SELECT SUM(x1) AS s_x1, x2 AS g_x2 FROM x GROUP BY g_x2) SELECT * FROM __tmp1 WHERE s_x1 > 0"
    },
    {
      "sql": "FROM x |> SELECT x.x1 |> UNION ALL (SELECT 1 AS c)",
      "expected": "WITH __tmp1 AS (SELECT x.x1 FROM x), __tmp2 AS (SELECT * FROM __tmp1), __tmp3 AS (SELECT * FROM __tmp2 UNION ALL SELECT 1 AS c) SELECT * FROM __tmp3"
    },
    {
      "sql": "FROM d.x |> SELECT x.x1 |> UNION (SELECT 2 AS a1) |> SELECT x1 |> UNION (SELECT 3 as a2) |> SELECT x1 |> WHERE x1 > 100",
      "expected": "WITH __tmp1 AS (\n  SELECT\n    x.x1\n  FROM d.x\n), __tmp2 AS (\n  SELECT\n    *\n  FROM __tmp1\n), __tmp3 AS (\n  SELECT\n    *\n  FROM __tmp2\n  UNION\n  SELECT\n    2 AS a1\n), __tmp4 AS (\n  SELECT\n    x1\n  FROM __tmp3\n), __tmp5 AS (\n  SELECT\n    *\n  FROM __tmp4\n), __tmp6 AS (\n  SELECT\n    *\n  FROM __tmp5\n  UNION\n  SELECT\n    3 AS a2\n), __tmp7 AS (\n  SELECT\n    x1\n  FROM __tmp6\n)\nSELECT\n  *\nFROM __tmp7\nWHERE\n  x1 > 100"
    },
    {
      "sql": "FROM c.x |> UNION ALL (SELECT 2 AS a1, '2' as a2) |> AGGREGATE AVG(x1) as m_x1 |> SELECT * |> UNION ALL (SELECT y1 FROM c.y) |> SELECT m_x1",
      "expected": "WITH __tmp1 AS (\n  SELECT\n    *\n  FROM c.x\n), __tmp2 AS (\n  SELECT\n    *\n  FROM __tmp1\n  UNION ALL\n  SELECT\n    2 AS a1,\n    '2' AS a2\n), __tmp3 AS (\n  SELECT\n    AVG(x1) AS m_x1\n  FROM __tmp2\n), __tmp4 AS (\n  SELECT\n    *\n  FROM __tmp3\n), __tmp5 AS (\n  SELECT\n    *\n  FROM __tmp4\n), __tmp6 AS (\n  SELECT\n    *\n  FROM __tmp5\n  UNION ALL\n  SELECT\n    y1\n  FROM c.y\n), __tmp7 AS (\n  SELECT\n    m_x1\n  FROM __tmp6\n)\nSELECT\n  *\nFROM __tmp7"
    },
    {
      "sql": "FROM c.x |> UNION ALL (SELECT 2 AS a1, '2' as a2) |> UNION ALL (SELECT y1 FROM c.y) |> WHERE x > 200",
      "expected": "WITH __tmp1 AS (\n  SELECT\n    *\n  FROM c.x\n), __tmp2 AS (\n  SELECT\n    *\n  FROM __tmp1\n  UNION ALL\n  SELECT\n    2 AS a1,\n    '2' AS a2\n), __tmp3 AS (\n  SELECT\n    *\n  FROM __tmp2\n), __tmp4 AS (\n  SELECT\n    *\n  FROM __tmp3\n  UNION ALL\n  SELECT\n    y1\n  FROM c.y\n)\nSELECT\n  *\nFROM __tmp4\nWHERE\n  x > 200"
    },
    {
      "sql": "FROM x |> CROSS JOIN y",
      "expected": "SELECT * FROM x CROSS JOIN y"
    },
    {
      "sql": "FROM x |> PIVOT(SUM(x1) FOR quarter IN ('foo1', 'foo2'))",
      "expected": "WITH __tmp1 AS (SELECT * FROM x PIVOT(SUM(x1) FOR quarter IN ('foo1', 'foo2'))) SELECT * FROM __tmp1"
    },
    {
      "sql": "FROM x |> JOIN y on x.id = y.id |> PIVOT(SUM(x1) FOR quarter IN ('foo1', 'foo2'))",
      "expected": "WITH __tmp1 AS (SELECT * FROM x PIVOT(SUM(x1) FOR quarter IN ('foo1', 'foo2')) JOIN y ON x.id = y.id) SELECT * FROM __tmp1"
    },
    {
      "sql": "FROM x |> UNPIVOT(col FOR item IN (foo1, foo2))",
      "expected": "WITH __tmp1 AS (SELECT * FROM x UNPIVOT(col FOR item IN (foo1, foo2))) SELECT * FROM __tmp1"
    },
    {
      "sql": "FROM x |> JOIN y on x.id = y.id |> UNPIVOT(col FOR item IN (foo1, foo2))",
      "expected": "WITH __tmp1 AS (SELECT * FROM x UNPIVOT(col FOR item IN (foo1, foo2)) JOIN y ON x.id = y.id) SELECT * FROM __tmp1"
    },
    {
      "sql": "FROM x |> AS a_x |> WHERE a_x.x1 > 0",
      "expected": "WITH a_x AS (SELECT * FROM x) SELECT * FROM a_x WHERE a_x.x1 > 0"
    },
    {
      "sql": "FROM x AS t |> AGGREGATE SUM(x1) AS s_x1 GROUP BY id, x2 |> AS t1 |> JOIN y AS t2 ON t1.id = t2.id |> SELECT t2.id, s_x1",
      "expected": "WITH __tmp1 AS (SELECT SUM(x1) AS s_x1, id, x2 FROM x AS t GROUP BY id, x2), t1 AS (SELECT * FROM __tmp1), __tmp2 AS (SELECT t2.id, s_x1 FROM t1 JOIN y AS t2 ON t1.id = t2.id) SELECT * FROM __tmp2"
    },
    {
      "sql": "FROM x |> JOIN y ON x.x1 = y.y1 |> AS a |> WHERE a.x2 > 1",
      "expected": "WITH a AS (SELECT * FROM x JOIN y ON x.x1 = y.y1) SELECT * FROM a WHERE a.x2 > 1"
    },
    {
      "sql": "FROM x |> EXTEND id IN (1, 2) AS is_1_2, id + 1 as a_id",
      "expected": "WITH __tmp1 AS (SELECT *, id IN (1, 2) AS is_1_2, id + 1 AS a_id FROM x) SELECT * FROM __tmp1"
    },
    {
      "sql": "FROM x |> SELECT x.x1, x.x2 |> EXTEND x1 + 1 as x1_1, x2 + 1 as x2_1 |> WHERE x1_1 > 0 AND x2_1 > 0",
      "expected": "WITH __tmp1 AS (SELECT x.x1, x.x2 FROM x), __tmp2 AS (SELECT *, x1 + 1 AS x1_1, x2 + 1 AS x2_1 FROM __tmp1) SELECT * FROM __tmp2 WHERE x1_1 > 0 AND x2_1 > 0"
    },
    {
      "sql": "FROM (SELECT 'foo1' AS item1, 2 AS item2 UNION ALL SELECT 'foo2' AS item1, 5 AS item2) |> EXTEND SUM(item2) OVER() AS item2_sum",
      "expected": "SELECT * FROM (WITH __tmp1 AS (SELECT *, SUM(item2) OVER () AS item2_sum FROM (SELECT 'foo1' AS item1, 2 AS item2 UNION ALL SELECT 'foo2' AS item1, 5 AS item2)) SELECT * FROM __tmp1)"
    },
    {
      "sql": "FROM x |> TABLESAMPLE SYSTEM (1 PERCENT)",
      "expected": "SELECT * FROM x TABLESAMPLE SYSTEM (1 PERCENT)"
    },
    {
      "sql": "FROM x |> SELECT x.x1 |> TABLESAMPLE SYSTEM (1 PERCENT)",
      "expected": "WITH __tmp1 AS (SELECT x.x1 FROM x TABLESAMPLE SYSTEM (1 PERCENT)) SELECT * FROM __tmp1"
    },
    {
      "sql": "FROM x |> TABLESAMPLE SYSTEM (1 PERCENT) |> WHERE x.x1 > 0 |> SELECT x1, x2",
      "expected": "WITH __tmp1 AS (SELECT x1, x2 FROM x WHERE x.x1 > 0 TABLESAMPLE SYSTEM (1 PERCENT)) SELECT * FROM __tmp1"
    }
  ],
  "transpilation": []
}